
<%
  let listArr = site.categories.data.reduce((acc, curr) => {
    acc[curr._id] = { ...curr, list: [] };
    return acc;
  }, {});

  let noCate = '默认分类';
  listArr[noCate] = { _id: 'defaultCate', name: noCate, list: [] };

  site.posts.each((item) => {
    let id = item.categories.data.length ? item.categories.data[0]._id : noCate;
    listArr[id].list.push({ title: item.title, link: item.path });
  });
%>

<article>
  <% let tocHTML = '' %>
  <h1 class="title"><%- page.title %></h1>
  <div class="entry-content">
    <% for( let i in listArr ) {
      tocHTML+= (listArr[i].list.length ? `<h3 id="${listArr[i]._id}">${(listArr[i].name).toLowerCase()}</h3>` :'')
    } %>

    <% if (tocHTML.length) { %>
      <div class="post-toc">
        <div class="toc-title">TOC</div>
        <%- toc(tocHTML) %>
      </div>
    <% } %>

    <% for( let i in listArr ) { %>
      <% if (listArr[i].list.length) { %>
        <h3 id="<%=listArr[i]._id%>">「 <%= (listArr[i].name).toLowerCase()%> 」</h3>
        <ul>
          <% for( let index = 0; index < listArr[i].list.length; index++ ) { %>
            <li>
              <a href="<%- config.root %><%- listArr[i].list[index].link %>"><%= listArr[i].list[index].title %> </a>
            </li>
            <% } %>
        </ul>
      <% } %>
    <% } %>
  </div>
</article>