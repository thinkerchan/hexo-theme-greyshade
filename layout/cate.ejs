
<%
  let listArr = site.categories.data.map(item=>{
    return {
      _id:item._id,
      name:item.name
    }
  })

  for( let i in listArr ) {
    listArr[i].list = []
  }

  let noCate = '默认分类'
  listArr.push({
    _id:'defaultCate',
    name:noCate,
    list:[]
  })

  console.log(`listArr`, listArr);

  let posts = listArr.map(item=>{
    site.posts.map(itm=>{
      let artInfo = itm.categories.data[0]
      if (artInfo) {
        if (item._id == artInfo._id) {
          item.list.push(itm)
        }
      }
    })
  })

  console.log(`posts`, posts);

%>

<article>
  <% let tocHTML = '' %>
  <h1 class="title"><%- page.title %></h1>
  <div class="entry-content">
    <% for( let i in listArr ) {
      tocHTML+= (listArr[i].list.length ? `<h3 id="${listArr[i]._id}">${(listArr[i].name).toLowerCase()}</h3>` :'')
    } %>

    <% if (tocHTML.length) { %>
      <div class="post-toc">
        <div class="toc-title">TOC</div>
        <%- toc(tocHTML) %>
      </div>
    <% } %>

    <% for( let i in listArr ) { %>
      <% if (listArr[i].list.length) { %>
        <h3 id="<%=listArr[i]._id%>">「 <%= (listArr[i].name).toLowerCase()%> 」</h3>
        <ul>
          <% for( let index = 0; index < listArr[i].list.length; index++ ) { %>
            <li>
              <a href="<%- config.root %><%- listArr[i].list[index].link %>"><%= listArr[i].list[index].title %> </a>
            </li>
            <% } %>
        </ul>
      <% } %>
    <% } %>
  </div>
</article>